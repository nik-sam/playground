name: PR Link Replacement

on:
  pull_request:
    types: [opened]

permissions:
  pull-requests: write

jobs:
  process-template:
    runs-on: ubuntu-latest
    steps:
      - name: Process PR Template
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const pr = context.payload.pull_request;
            let body = pr.body;
            
            let branchName = pr.head.ref;

            // Replace forward slashes with dashes
            let transformedBranchName = branchName.replace(/\//g, '-');
            
            let sandboxLink = `[Sandbox](https://branch-${transformedBranchName}.sandbox.internal.samsara.com)`;
            
            let devStoryBookLink = `[Dev Storybook](https://dev-storybook.internal.samsara.com/branches/${transformedBranchName}/index.html)`;

            let kitStoryBookLink = `[Kit Storybook](https://kit.internal.samsara.com/branches/${transformedBranchName}/index.html)`;
            
            body = body.replace(/\[Sandbox\]\(\)/, sandboxLink);
            body = body.replace(/\[Dev Storybook\]\(\)/, devStoryBookLink);
            body = body.replace(/\[Kit Storybook\]\(\)/, kitStoryBookLink);

            // Update PR description
            await github.rest.pulls.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: pr.number,
              body: body
            });